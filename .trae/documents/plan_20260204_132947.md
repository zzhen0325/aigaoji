## 基金加减仓逻辑实现方案

为了准确实现交易截止时间（15:00）对收益计算的影响，我计划按以下步骤进行开发：

### 1. 核心交易工具类 (Trading Utilities)
- 在 `src/utils/tradingUtils.ts` 中实现：
    - `isBeforeDeadline()`: 判断当前是否在交易日 15:00 之前。
    - `getNextTradingDay(date)`: 计算下一个交易日（跳过周末和法定节假日）。
    - `getTradeInfo()`: 返回当前操作的生效时间说明（例如：“今日确认，明日起算收益” 或 “下个交易日确认”）。

### 2. 数据结构升级
- 修改 `src/types/index.ts` 中的 `UserPortfolio` 接口：
    - 增加 `transactions` 数组，记录每一笔加减仓的金额、类型、时间戳及生效日期。
    - 增加 `lastUpdateDate`: 用于在页面加载时判断是否需要将已生效的交易合并到基础持仓中。

### 3. 加减仓弹窗 (Transaction Modal)
- 新建 `src/components/TransactionModal.tsx`：
    - 提供“买入”和“卖出”选项。
    - 实时显示当前时间是否已过截止点。
    - **核心逻辑**：如果是截止前操作，记录当前日期为生效日；如果是截止后，记录下一个交易日为生效日。

### 4. 持仓页逻辑调整
- 修改 `src/pages/portfolio/Portfolio.tsx`：
    - **自动对账 (Reconciliation)**：进入页面时，检查是否有已过生效日的交易。若有，自动更新 `holdingAmount`（基础持仓）并将该交易转为历史记录。
    - **计算公式优化**：
        - `总资产` = `昨日持仓 * (1 + 估值涨幅)` + `今日已买入但未确认金额`。
        - `当日盈亏` = `昨日持仓 * 估值涨幅`（确保今日新买入的部分不计入今日盈亏）。
    - **UI 更新**：在表格中为每只基金增加“交易”按钮。

### 5. 详情页联动
- 在 `src/pages/fund/FundDetail.tsx` 增加“买入/卖出”快速操作入口。

确认后我将开始实施上述改动。
